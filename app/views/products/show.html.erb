

<h1><%= flash[:message] %></h1>
<p id="notice"><%= notice %></p>
<%= link_to 'Back', products_path %>
<br>
<h2>Brand: <%=@product.brand %></h2>
<h3>Model: <%=@product.model %></h3>
<h3>Rating: <%=@product.avg_rating %></h3>

<%= image_tag(@product.image) %>
<%= image_tag(@product.alt_image_1) %>
<%= image_tag(@product.alt_image_2) %>
<%= image_tag(@product.alt_image_3) %>

<h3>MSRP: <%=@product.msrp %></h3>
<h1>Our price: <%=@product.price %></h1>

<ul>
  <li>Orientation: <%=@product.orientation %></li>
  <li>Series: <%=@product.series %></li>
  <li>Year: <%=@product.year %></li>
  <li>Bridge: <%=@product.bridge_type %></li>
  <li>Frets: <%=@product.number_of_frets %></li>
  <li>Neck: <%=@product.neck_type %></li>
  <li>Neck Wood:<%=@product.neck_wood %></li>
  <li>Body Wood: <%=@product.body_wood %></li>
  <li>Case: <%=@product.case_type %></li>
  <li>Description: <%=@product.description %></li>
</ul>

<form id='add-to-cart'>
  <input type='button' value='Add to cart' class='add_to_cart_button'>
</form>
<div class="box">
    <input id="quantity" value="1" />
    <button id="down" onclick="modify_qty(-1)">-1</button>
    <button id="up" onclick="modify_qty(1)">+1</button>
</div>
<script>
  $(document).ready(function(){
    $('#add-to-cart').on('click', '.add_to_cart_button', function(){
      var user_id = <%= current_user.id %>;
      var product_id = <%= @product.id %>;
      var cart_quantity = $("input[id$='quantity']").val();
      var unit_price = <%= @product.price %>;
      var next_order = <%= @next_order %>;
      var create_new_order_id = <%= @create_new_order_id %>;
      if (create_new_order_id == true) {
        $.ajax({
        url: 'http://localhost:3000/orders',
        type: 'POST',
        data: {order: {id: next_order, user_id: user_id}}
      });//end of first ajax post
      var create_new_order_id = true;//reseting variable to stop POSTing
      }//end of if
      $.ajax({
        url: 'http://localhost:3000/order_products',
        type: 'POST',
        data: {order_product: {product_id: product_id, quantity: cart_quantity, unit_price: unit_price, order_id: next_order}}
      });//end of second ajax post
    });//end of on click
  });//end of document ready

</script>
<script>
function modify_qty(val) {
  var qty = document.getElementById('quantity').value;
  var new_qty = parseInt(qty,10) + val;
  if (new_qty < 1) {
    new_qty = 1;
  }
  document.getElementById('quantity').value = new_qty;
  return new_qty;
}
</script>


